{% if not settings.hide_element %}
<section class="tp-compare-section s-block" section-id="{{ sectionId }}">
	<div class="container">
		<div class="tp-compare-container">
			<div class="compare-box" data-before="{{ settings.title_2 }}" data-after="{{ settings.title_1 }}">
				<img 
					loading="lazy" 
					width="500" 
					height="500" 
					class="lazy-img" 
					src="{{ image_url(settings.image_2) }}" 
					alt="{{settings.title_2}}"
					fetchpriority="auto"/>
				<img 
					loading="lazy" 
					width="500" 
					height="500" 
					class="lazy-img" 
					src="{{ image_url(settings.image_1) }}" 
					alt="{{settings.title_1}}"
					fetchpriority="auto"/>
			</div>
			<div class="tp-compare-content">
				{% if settings.sub_title %}
					<span>{{ settings.sub_title }}</span>
				{% endif %}
				{% if settings.title %}
					<h3 >{{ settings.title }}</h3>
				{% endif %}
				{% if settings.additional_text %}
					<p >{{ settings.additional_text }}</p>
				{% endif %}
				{% if settings.btn_text %}
					<a href="{% if settings.url %}{{ settings.url }}{% else %}javascript:;{% endif %}" class="tp-btn">
						{{ settings.btn_text }}
					</a>
				{% endif %}
			</div>
		</div>
	</div>
</section>
<script>
(function() {
  function initImageCompare() {
    const section = document.querySelector('[section-id="{{ sectionId }}"]');
    if (!section) return;
    
    const viewers = section.querySelectorAll(".compare-box");
    if (viewers.length === 0) return;

    function loadLibrary() {
      // تحميل CSS
      if (!document.querySelector('link[href*="image-compare-viewer"]')) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = 'https://cdn.jsdelivr.net/npm/image-compare-viewer@1.5.0/dist/image-compare-viewer.min.css';
        document.head.appendChild(link);
      }

      // تحميل JS
      if (typeof ImageCompare === 'undefined') {
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/image-compare-viewer@1.5.0/dist/image-compare-viewer.min.js';
        script.onload = function() {
          initCompare();
        };
        document.body.appendChild(script);
      } else {
        initCompare();
      }
    }

    function initCompare() {
      viewers.forEach((element) => {
        if (element.dataset.initialized === 'true') return;
        
        const beforeLabel = element.dataset.before || 'بعد';
        const afterLabel = element.dataset.after || 'قبل';
        const options = {
          controlColor: "#fff",
          addCircle: true,
          addCircleBlur: true,
          showLabels: true,
          labelOptions: {
            before: beforeLabel,
            after: afterLabel
          },
          startingPoint: 50
        };
        
        try {
          new ImageCompare(element, options).mount();
          element.dataset.initialized = 'true';
        } catch (e) {
          console.warn('ImageCompare initialization failed:', e);
        }
      });
    }

    loadLibrary();
  }

  if ('IntersectionObserver' in window) {
    var section = document.querySelector('[section-id="{{ sectionId }}"]');
    if (section) {
      var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            initImageCompare();
            observer.unobserve(entry.target);
          }
        });
      }, {
        rootMargin: '300px'
      });
      
      observer.observe(section);
    }
  } else {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initImageCompare);
    } else {
      initImageCompare();
    }
  }
})();
</script>
{% endif %}


