    {% if not settings.hide_element %}
    <section class="tp-brands s-block {% if settings.rounded_edges %} rounded-edges {% endif %}" section-id="{{ sectionId }}">
      <style>
        /* قبل ما slick يتهيأ، خفي الشرائح غير المرئية */
        [section-id="{{ sectionId }}"] .tp-brands-swiper:not(.slick-initialized) .swiper-slide:not(:first-child) {
          display: none;
        }
      </style>
      
      <div class="container">
        <div class="tp-title-section">
          {% if settings.small_subtitle %}
            <span>{{ settings.small_subtitle }}</span>
          {% endif %}
          {% if settings.title %}
            <h3 >{{ settings.title }}</h3>
          {% endif %}
          {% if settings.small_text %}
            <p >{{ settings.small_text }}</p>
          {% endif %}
        </div>
        <div class="tp-brands-swiper">
        {% if 'brands' in settings %}
          {% set brands = settings.brands %}
          {% if brands is callable %}
            {% set brands = brands() %}
          {% endif %}
        {% else %}
          {% set brands = [] %}
        {% endif %}
        {% if brands is not iterable %}
            {% set brands = [] %}
        {% endif %}

            {% for brand in brands %}
            <div class="swiper-slide" >
              <div class="tp-brand-item">
                <div class="tp-brand-thumb">
                  {% if brand.image %}
                  <a href="{% if brand.url %}{{ brand.url }}{% else %}javascript:;{% endif %}" aria-label="brand">
                    <img loading="lazy" width="125" height="125" class="lazy-img" src="{{ image_url(brand.image) }}"  alt="">
                  </a>
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
        </div>


          <script>
  (function() {
    function initSlider() {
      var arrowNextClass = (window.appDirection === 'ltr') ? 'icon-keyboard_arrow_right' : 'icon-keyboard_arrow_left';
      var arrowPrevClass = (window.appDirection === 'ltr') ? 'icon-keyboard_arrow_left' : 'icon-keyboard_arrow_right';

      var $slider = $('[section-id="{{ sectionId }}"] .tp-brands-swiper');

      if ($slider.length && !$slider.hasClass('slick-initialized')) {
        $slider.slick({
                slidesToScroll: 1,
                slidesToShow: 9,
                infinite: true,
                autoplay: true,
                autoplaySpeed: 1000,
                pauseOnHover: true,
                arrows: false,
                dots: false,
                rtl: !(window.appDirection === 'ltr'),
                nextArrow: '<button class="slick-next slick-arrow" aria-label="Next" type="button"><span class="' + arrowNextClass + '"></span></button>',
                prevArrow: '<button class="slick-prev slick-arrow" aria-label="Previous" type="button"><span class="' + arrowPrevClass + '"></span></button>',
                responsive: [
                  { breakpoint: 1200, settings: { slidesToShow: 8 } },
                  { breakpoint: 1024, settings: { slidesToShow: 7 } },
                  { breakpoint: 992, settings: { slidesToShow: 6 } },
                  { breakpoint: 768, settings: { slidesToShow: 5 } },
                  { breakpoint: 450, settings: { slidesToShow: 4 } },
                  { breakpoint: 375, settings: { slidesToShow: 3 } },
                ]
              });
      }
    }

    if ('IntersectionObserver' in window) {
      var section = document.querySelector('[section-id="{{ sectionId }}"]');
      if (section) {
        var observer = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              if (typeof $ !== 'undefined' && typeof $.fn.slick !== 'undefined') {
                initSlider();
                observer.unobserve(entry.target);
              } else {
                if (document.readyState === 'loading') {
                  document.addEventListener('DOMContentLoaded', initSlider);
                } else {
                  initSlider();
                }
                observer.unobserve(entry.target);
              }
            }
          });
        }, {
          rootMargin: '300px'
        });
        
        observer.observe(section);
      }
    } else {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSlider);
      } else {
        initSlider();
      }
    }
  })();
</script>

    </section> 
{% endif %}


