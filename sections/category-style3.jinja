{% if not settings.hide_element %}
<section class="tp-category-style3 s-block" section-id="{{ sectionId }}">
	<style>
		/* قبل ما slick يتهيأ، خفي الشرائح غير المرئية */
		[section-id="{{ sectionId }}"] .tp-category-style3-swiper:not(.slick-initialized) .swiper-slide:not(:first-child) {
			display: none;
		}
	</style>
	
	<div class="container">
		<div class="tp-title-section">
			{% if settings.small_subtitle %}
				<span>{{ settings.small_subtitle }}</span>
			{% endif %}
			{% if settings.title %}
				<h3 >{{ settings.title }}</h3>
			{% endif %}
			{% if settings.small_text %}
				<p >{{ settings.small_text }}</p>
			{% endif %}
		</div>
	</div>
  {% if 'category_style2' in settings %}
    {% set category_style2 = settings.category_style2 %}
    {% if category_style2 is callable %}
      {% set category_style2 = category_style2() %}
    {% endif %}
  {% else %}
    {% set category_style2 = [] %}
  {% endif %}
{% if category_style2 is not iterable %}
    {% set category_style2 = [] %}
{% endif %}
	<div class="tp-category-style3-swiper {% if settings.disable_slider %} no-slider {% endif %}">
			{% for slide in category_style2 %}
				<div class="swiper-slide">
					<a href="{% if slide.url %}{{ slide.url }}{% else %}javascript:;{% endif %}">
						{% if slide.image %}
							<img loading="lazy" width="600" height="600" class="lazy-img" src="{{ image_url(slide.image) }}"  alt="">
						{% endif %}
						<div class="category-style3-content">
							{% if slide.sub_title %}
								<span style="color: {{slide.sub_title_color}}">{{ slide.sub_title }}</span>
							{% endif %}
							{% if slide.title %}
								<h3 style="color: {{slide.title_color}}">{{ slide.title }}</h3>
							{% endif %}
							{% if slide.btn_text %}
								<button type="text" class="tp-btn tp-btn-white">
									{{ slide.btn_text }}
								</button>
							{% endif %}
						</div>
					</a>
				</div>
			{% endfor %}
	</div>

   <script>
  (function() {
    function initSlider() {
      var arrowNextClass = (window.appDirection === 'ltr') ? 'icon-keyboard_arrow_right' : 'icon-keyboard_arrow_left';
      var arrowPrevClass = (window.appDirection === 'ltr') ? 'icon-keyboard_arrow_left' : 'icon-keyboard_arrow_right';

      var $slider = $('[section-id="{{ sectionId }}"] .tp-category-style3-swiper');

      if (
          $slider.length &&
          !$slider.hasClass('slick-initialized') &&
          (
            window.innerWidth >= 768 ||
            !{{ 'true' if settings.disable_slider else 'false' }}
          )
        ) {
        $slider.slick({
          slidesToScroll: 2,
          slidesToShow: 2,
          infinite: true,
          autoplay: true,
          autoplaySpeed: 4000,
          arrows: true,
          dots: false,
          rtl: !(window.appDirection === 'ltr'),
          nextArrow: '<button class="slick-next slick-arrow" aria-label="Next" type="button" style=""><span class="'+arrowNextClass+'"></span></button>',
          prevArrow: '<button class="slick-prev slick-arrow" aria-label="Previous" type="button" style=""><span class="'+arrowPrevClass+'"></span></button>'
        });
      }
    }

    if ('IntersectionObserver' in window) {
      var section = document.querySelector('[section-id="{{ sectionId }}"]');
      if (section) {
        var observer = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              if (typeof $ !== 'undefined' && typeof $.fn.slick !== 'undefined') {
                initSlider();
                observer.unobserve(entry.target);
              } else {
                if (document.readyState === 'loading') {
                  document.addEventListener('DOMContentLoaded', initSlider);
                } else {
                  initSlider();
                }
                observer.unobserve(entry.target);
              }
            }
          });
        }, {
          rootMargin: '300px'
        });
        
        observer.observe(section);
      }
    } else {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSlider);
      } else {
        initSlider();
      }
    }
  })();
</script>

</section>
{% endif %}


